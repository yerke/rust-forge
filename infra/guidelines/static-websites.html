<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Static websites - Rust Forge</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="Supplemental documentation for contributing to The Rust Programming Language">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../../index.html">Overview</a></li><li class="chapter-item expanded "><a href="../../platforms/index.html">Platforms</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../platforms/twitter.html">Twitter</a></li><li class="chapter-item expanded "><a href="../../platforms/discord.html">Discord</a></li><li class="chapter-item expanded "><a href="../../platforms/email.html">Email</a></li><li class="chapter-item expanded "><a href="../../platforms/github.html">GitHub</a></li><li class="chapter-item expanded "><a href="../../platforms/zulip.html">Zulip</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../platforms/zulip/moderation.html">Moderation</a></li></ol></li><li class="chapter-item expanded "><a href="../../platforms/blogs.html">Blogs</a></li><li class="chapter-item expanded "><a href="../../platforms/calendars.html">Calendars</a></li></ol></li><li class="chapter-item expanded "><a href="../../triagebot/index.html">Triagebot</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../triagebot/agenda.html">Agenda Generator</a></li><li class="chapter-item expanded "><a href="../../triagebot/issue-assignment.html">Issue Assignment</a></li><li class="chapter-item expanded "><a href="../../triagebot/pr-assignment.html">PR Assignment</a></li><li class="chapter-item expanded "><a href="../../triagebot/pr-assignment-tracking.html">Tracking PR assignment</a></li><li class="chapter-item expanded "><a href="../../triagebot/autolabels.html">Autolabels</a></li><li class="chapter-item expanded "><a href="../../triagebot/close.html">Close</a></li><li class="chapter-item expanded "><a href="../../triagebot/doc-updates.html">Documentation Updates</a></li><li class="chapter-item expanded "><a href="../../triagebot/github-releases.html">GitHub Releases</a></li><li class="chapter-item expanded "><a href="../../triagebot/glacier.html">Glacier</a></li><li class="chapter-item expanded "><a href="../../triagebot/transfer.html">Issue Transfer</a></li><li class="chapter-item expanded "><a href="../../triagebot/labeling.html">Labeling</a></li><li class="chapter-item expanded "><a href="../../triagebot/major-changes.html">Major Changes</a></li><li class="chapter-item expanded "><a href="../../triagebot/mentions.html">Mentions</a></li><li class="chapter-item expanded "><a href="../../triagebot/no-merge.html">No Merge Policy</a></li><li class="chapter-item expanded "><a href="../../triagebot/nominate.html">Nominate</a></li><li class="chapter-item expanded "><a href="../../triagebot/note.html">Note</a></li><li class="chapter-item expanded "><a href="../../triagebot/notifications.html">Notifications</a></li><li class="chapter-item expanded "><a href="../../triagebot/pinging.html">Pinging</a></li><li class="chapter-item expanded "><a href="../../triagebot/requesting-prioritization.html">Requesting Prioritization</a></li><li class="chapter-item expanded "><a href="../../triagebot/review-submitted.html">Review Changes Requested</a></li><li class="chapter-item expanded "><a href="../../triagebot/review-requested.html">Review Requested</a></li><li class="chapter-item expanded "><a href="../../triagebot/rustc-commit-list.html">Rustc Commit Tracking</a></li><li class="chapter-item expanded "><a href="../../triagebot/shortcuts.html">Shortcuts</a></li><li class="chapter-item expanded "><a href="../../triagebot/triage-dashboard.html">Triagebot Dashboard</a></li><li class="chapter-item expanded "><a href="../../triagebot/zulip-meeting.html">Zulip Meeting Management</a></li><li class="chapter-item expanded "><a href="../../triagebot/zulip-notifications.html">Zulip Notifications</a></li></ol></li><li class="chapter-item expanded "><a href="../../community/index.html">Community</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../community/survey-faq.html">State of Rust Survey FAQ</a></li></ol></li><li class="chapter-item expanded "><a href="../../compiler/index.html">Compiler</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../compiler/cross-compilation/index.html">Cross Compilation</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../compiler/cross-compilation/windows.html">Windows</a></li></ol></li><li class="chapter-item expanded "><a href="../../compiler/cross-team-collaboration.html">Cross-team Collaboration</a></li><li class="chapter-item expanded "><a href="../../compiler/reviews.html">Review policies</a></li><li class="chapter-item expanded "><a href="../../compiler/new_option.html">So you want to add a new option to rustc?</a></li><li class="chapter-item expanded "><a href="../../compiler/mcp.html">Major Change Proposals</a></li><li class="chapter-item expanded "><a href="../../compiler/membership.html">Membership</a></li><li class="chapter-item expanded "><a href="../../compiler/prioritization.html">Prioritization</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../compiler/prioritization/procedure.html">Procedure</a></li><li class="chapter-item expanded "><a href="../../compiler/prioritization/priority-levels.html">Priority Levels</a></li></ol></li><li class="chapter-item expanded "><a href="../../compiler/notification-groups.html">Notification groups</a></li><li class="chapter-item expanded "><a href="../../compiler/triage-meeting.html">Triage Meeting</a></li><li class="chapter-item expanded "><a href="../../compiler/steering-meeting.html">Steering Meeting</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../compiler/steering-meeting/submit.html">Submitting a proposal</a></li><li class="chapter-item expanded "><a href="../../compiler/steering-meeting/how-to-run-planning.html">How to run the planning meeting</a></li><li class="chapter-item expanded "><a href="../../compiler/steering-meeting/how-to-run-design.html">How to run a design meeting</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../../crates-io/index.html">crates.io</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../crates-io/crate-removal.html">Crate removal</a></li><li class="chapter-item expanded "><a href="../../crates-io/db-maintenance.html">Database maintenance</a></li></ol></li><li class="chapter-item expanded "><a href="../../docs-rs/index.html">docs.rs</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../docs-rs/add-dependencies.html">Adding dependencies to the build environment</a></li><li class="chapter-item expanded "><a href="../../docs-rs/self-hosting.html">Self-hosting a docs.rs instance</a></li><li class="chapter-item expanded "><a href="../../docs-rs/maintenance.html">Maintenance procedures</a></li></ol></li><li class="chapter-item expanded "><a href="../../governance/index.html">Governance</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../governance/council.html">Leadership Council</a></li><li class="chapter-item expanded "><a href="../../governance/moderation.html">Moderation</a></li></ol></li><li class="chapter-item expanded "><a href="../../policies/index.html">Policies</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../policies/crate-ownership.html">Crate ownership policy</a></li></ol></li><li class="chapter-item expanded "><a href="../../infra/index.html">Infrastructure</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../infra/other-installation-methods.html">Other Installation Methods</a></li><li class="chapter-item expanded "><a href="../../infra/archive-stable-version-installers.html">Archive of Rust Stable Standalone Installers</a></li><li class="chapter-item expanded "><a href="../../infra/channel-layout.html">Release Channel Layout</a></li><li class="chapter-item expanded "><a href="../../infra/service-infrastructure.html">Service Infrastructure</a></li><li class="chapter-item expanded "><a href="../../infra/team-maintenance.html">Team Maintenance</a></li><li class="chapter-item expanded "><a href="../../infra/toolstate.html">The Toolstate System</a></li><li class="chapter-item expanded "><a href="../../infra/policies/index.html">Policies</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../infra/policies/broken-nightlies.html">Broken nightlies</a></li></ol></li><li class="chapter-item expanded "><a href="../../infra/guidelines/index.html">Guidelines</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../infra/guidelines/static-websites.html" class="active">Static websites</a></li></ol></li><li class="chapter-item expanded "><a href="../../infra/docs/index.html">Documentation</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../infra/docs/aws-access.html">AWS access for team members</a></li><li class="chapter-item expanded "><a href="../../infra/docs/aws-access-management.html">AWS access management</a></li><li class="chapter-item expanded "><a href="../../infra/docs/aws-regions.html">AWS regions</a></li><li class="chapter-item expanded "><a href="../../infra/docs/bastion.html">Bastion server</a></li><li class="chapter-item expanded "><a href="../../infra/docs/bors.html">Bors</a></li><li class="chapter-item expanded "><a href="../../infra/docs/cdn.html">CDN</a></li><li class="chapter-item expanded "><a href="../../infra/docs/crater-agents.html">Crater agents</a></li><li class="chapter-item expanded "><a href="../../infra/docs/gha-self-hosted.html">Custom GitHub Actions runners</a></li><li class="chapter-item expanded "><a href="../../infra/docs/dev-desktop.html">Dev Desktops</a></li><li class="chapter-item expanded "><a href="../../infra/docs/dev-desktop-github-app.html">GitHub App for dev-desktops</a></li><li class="chapter-item expanded "><a href="../../infra/docs/discord-mods-bot.html">Discord moderation bot</a></li><li class="chapter-item expanded "><a href="../../infra/docs/dns.html">Domain names and DNS</a></li><li class="chapter-item expanded "><a href="../../infra/docs/docs-rs.html">docs.rs</a></li><li class="chapter-item expanded "><a href="../../infra/docs/ecs-services.html">ECS services management</a></li><li class="chapter-item expanded "><a href="../../infra/docs/monitoring.html">Monitoring</a></li><li class="chapter-item expanded "><a href="../../infra/docs/rust-bots.html">rust-bots server</a></li><li class="chapter-item expanded "><a href="../../infra/docs/rustc-ci.html">rust-lang/rust CI</a></li><li class="chapter-item expanded "><a href="../../infra/docs/sentry.html">Sentry</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../../lang/index.html">Language</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../lang/rfc-merge-procedure.html">RFC Merge Procedure</a></li><li class="chapter-item expanded "><a href="../../lang/triage-meeting-procedure.html">Triage Meeting Procedure</a></li></ol></li><li class="chapter-item expanded "><a href="../../libs/index.html">Libs</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../libs/maintaining-std.html">Maintaining the standard library</a></li></ol></li><li class="chapter-item expanded "><a href="../../release/index.html">Release</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../release/backporting.html">Backporting</a></li><li class="chapter-item expanded "><a href="../../release/release-notes.html">Preparing Release Notes</a></li><li class="chapter-item expanded "><a href="../../release/process.html">Release Process</a></li><li class="chapter-item expanded "><a href="../../release/rollups.html">Rollup Procedure</a></li><li class="chapter-item expanded "><a href="../../release/triage-procedure.html">Triage Procedure</a></li><li class="chapter-item expanded "><a href="../../release/issue-triaging.html">Issue Triaging</a></li><li class="chapter-item expanded "><a href="../../release/crater.html">Triaging Crater Runs</a></li></ol></li><li class="chapter-item expanded "><a href="../../editions/edition-releases.html">Edition Releases</a></li><li class="chapter-item expanded "><a href="../../archive/index.html">Archive</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../archive/fott.html">Friends of the Tree</a></li><li class="chapter-item expanded "><a href="../../archive/release-history.html">Release History</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Rust Forge</h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/rust-lang/rust-forge" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/rust-lang/rust-forge/edit/master/src/infra/guidelines/static-websites.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="rust-infrastructure-hosting-for-static-websites"><a class="header" href="#rust-infrastructure-hosting-for-static-websites">Rust Infrastructure hosting for static websites</a></h1>
<p>The Rust Infrastructure team provides hosting for static websites available for
all Rust teams. This document explains the requirements a website needs to meet
and how to setup one.</p>
<h2 id="requirements-for-hosting-websites"><a class="header" href="#requirements-for-hosting-websites">Requirements for hosting websites</a></h2>
<ul>
<li><strong>The website must be managed by a Rust team, or be officially affiliated with
the project.</strong><br />
The infrastructure team has finite resources and we can’t offer hosting for
community projects.</li>
<li><strong>The website’s content and build tooling must be hosted on a GitHub
repository in either the <a href="https://github.com/rust-lang">rust-lang</a> or
<a href="https://github.com/rust-lang-nursery">rust-lang-nursery</a> organizations.</strong><br />
The infrastructure team must be able to rebuild the website content at any
time (for example if we need to switch hosting), and having it hosted on a
GitHub repository inside infra-managed organizations is the best way for us
to ensure that. Even though we’d prefer for all the repositories to be public
it’s not a requirement.</li>
<li><strong>The website must be built and deployed with a CI service.</strong><br />
We have custom tooling built around hosting static websites on our infra, and
at the moment they work with Travis CI and Azure Pipelines. If you need
different CI services ask us in advance and we’ll adapt the tooling to your
provider of choice.</li>
<li><strong>The website must reach an A+ grade on the
<a href="https://observatory.mozilla.org/">Mozilla Observatory</a>.</strong><br />
Browsers have multiple security features toggleable only through HTTP
response headers, and those features enhance users’ privacy and prevent
exploits from working. An A+ grade on the Observatory indicates all the
important headers are correctly set.</li>
<li><strong>The website must be hosted on platforms vetted by the infra team.</strong><br />
We recommend either GitHub Pages or Amazon S3 (in the rust-lang AWS account)
as the hosting and CloudFront as the CDN, but if you need other platforms
that’s good as long as we consider them secure and reliable.</li>
</ul>
<h2 id="static-websites-configuration"><a class="header" href="#static-websites-configuration">Static websites configuration</a></h2>
<p>To avoid limitations of some hosting providers we have setup CloudFront to
enable additional, custom behaviors. These behaviors are configured through a
file named <code>website_config.json</code> at the root of the generated website content.</p>
<h3 id="adding-custom-headers"><a class="header" href="#adding-custom-headers">Adding custom headers</a></h3>
<p>One of the requirements for having a static website hosted by the
infrastructure team is to reach an A+ grade on the <a href="https://observatory.mozilla.org/">Mozilla
Observatory</a>, and that requires custom
headers to be set. To setup custom headers you need to add an <code>headers</code> section
to <code>website_config.json</code>. This example content includes all the headers
needed to reach grade B on the Observatory (to reach grade A+ a Content
Security Policy is required):</p>
<pre><code class="language-json">{
    &quot;headers&quot;: {
        &quot;Strict-Transport-Security&quot;: &quot;max-age=63072000&quot;,
        &quot;X-Content-Type-Options&quot;: &quot;nosniff&quot;,
        &quot;X-Frame-Options&quot;: &quot;DENY&quot;,
        &quot;X-XSS-Protection&quot;: &quot;1; mode=block&quot;,
        &quot;Referrer-Policy&quot;: &quot;no-referrer, strict-origin-when-cross-origin&quot;
    }
}
</code></pre>
<h3 id="fixing-github-pages-redirects"><a class="header" href="#fixing-github-pages-redirects">Fixing GitHub Pages redirects</a></h3>
<p>GitHub Pages behaves weirdly when it sits behind CloudFront and it needs to
issue redirects: since it doesn’t know the real domain name it will use
<code>http://org-name.github.io/repo-name</code> as the base of the redirect instead of
the correct protocol and domain. To prevent this behavior the
<code>github_pages_origin</code> key needs to be added to <code>website_config.json</code>
with the origin base url as the value (excluding the protocol):</p>
<pre><code class="language-json">{
    &quot;github_pages_origin&quot;: &quot;org-name.github.io/repo-name&quot;
}
</code></pre>
<h2 id="deployment-guide"><a class="header" href="#deployment-guide">Deployment guide</a></h2>
<p>These deployments steps are meant to be executed by a member of the
infrastructure team since they require access to our AWS account.</p>
<h3 id="configuring-aws"><a class="header" href="#configuring-aws">Configuring AWS</a></h3>
<p>Create a CloudFront web distribution and set the following properties:</p>
<ul>
<li><strong>Origin Domain Name:</strong> rust-lang.github.io/repo-name</li>
<li><strong>Origin Protocol Policy:</strong> HTTPS Only</li>
<li><strong>Viewer Protocol Policy:</strong> Redirect HTTP to HTTPS</li>
<li><strong>Lambda Function Association:</strong>
<ul>
<li><strong>Viewer Response:</strong> arn:aws:lambda:us-east-1:890664054962:function:static-websites:4</li>
</ul>
</li>
<li><strong>Alternate Domain Names:</strong> your-subdomain-name.rust-lang.org</li>
<li><strong>SSL Certificate:</strong> Custom SSL Certificate
<ul>
<li>You will need to request the certificate for that subdomain name through
ACM (please use the DNS challenge to validate the certificate)</li>
</ul>
</li>
<li><strong>Comment:</strong> your-subdomain-name.rust-lang.org</li>
</ul>
<p>Wait until the distribution is propagated and take note of its
<code>.cloudfront.net</code> domain name.</p>
<p>Head over to the domain’s Route 53 hosted zone and create a new record set:</p>
<ul>
<li><strong>Name:</strong> your-subdomain-name</li>
<li><strong>Type:</strong> CNAME</li>
<li><strong>Value:</strong> the <code>.cloudfront.net</code> domain name you saw earlier</li>
</ul>
<p>Create an AWS IAM user to allow the CI provider used to deploy website changes
to perform whitelisted automatic actions. Use <code>ci--ORG-NAME--REPO-NAME</code> (for
example <code>ci--rust-lang--rust</code>) as the user name, allow programmatic access to
it and add it to the <code>ci-static-websites</code> IAM group. Then take note of the
access key id and the secret access key since you’ll need those later.</p>
<h3 id="adding-deploy-keys"><a class="header" href="#adding-deploy-keys">Adding deploy keys</a></h3>
<p>To deploy websites we don’t use GitHub tokens (since they don’t have granular
access scoping) but a deploy key with write access unique for each repository.
To setup the deploy key you need to be an administrator on the repository,
clone the <a href="https://github.com/rust-lang/simpleinfra">simpleinfra</a> repository
and run this command:</p>
<pre><code>$ cargo run --bin setup-deploy-keys rust-lang/repo-name
</code></pre>
<p>The command requires the <code>GITHUB_TOKEN</code> (<a href="https://github.com/settings/tokens">you can generate one
here</a>) and the <code>TRAVIS_TOKEN</code> (<a href="https://travis-ci.com/account/preferences">you can see
yours here</a>) to be present. It will
generate a brand new key, upload it to GitHub and configure Travis CI to use
it if the repo is active there.</p>
<h3 id="configuring-travis-ci"><a class="header" href="#configuring-travis-ci">Configuring Travis CI</a></h3>
<p>To actually deploy the website, this snippet needs to be added to your
<code>.travis.yml</code> (please replace the contents of <code>RUSTINFRA_DEPLOY_DIR</code> and
<code>RUSTINFRA_CLOUDFRONT_DISTRIBUTION</code>):</p>
<pre><code class="language-yaml">env:
  RUSTINFRA_DEPLOY_DIR: path/to/be/deployed
  RUSTINFRA_CLOUDFRONT_DISTRIBUTION: ABCDEFGHIJKLMN
import:
  - rust-lang/simpleinfra:travis-configs/static-websites.yml
</code></pre>
<p>You will also need to set the contents of the <code>AWS_ACCESS_KEY_ID</code> and
<code>AWS_SECRET_ACCESS_KEY</code> environment variables on the Travis CI web UI with the
credentials of the IAM user you created earlier. The secret access key <strong>must</strong>
be hidden from the build log, while the access key id should be publicly
visible.</p>
<h3 id="configuring-azure-pipelines"><a class="header" href="#configuring-azure-pipelines">Configuring Azure Pipelines</a></h3>
<p>To actually deploy the website, this snippet needs to be added at the top of
your pipeline’s YAML file:</p>
<pre><code class="language-yaml">resources:
  repositories:
    - repository: rustinfra
      type: github
      name: rust-lang/simpleinfra
      endpoint: rust-lang
</code></pre>
<p>Then you can add this steps when you want to execute the deploy (please replace
the contents of <code>deploy_dir</code> and <code>cloudfront_distribution</code>):</p>
<pre><code class="language-yaml">- template: azure-configs/static-websites.yml@rustinfra
  parameters:
    deploy_dir: path/to/output
    # Optional, only needed if GitHub pages is behind CloudFront
    cloudfront_distribution: AAAAAAAAAAAAAA
</code></pre>
<p>You will also need to set the following environment variables in the pipeline:</p>
<ul>
<li><code>GITHUB_DEPLOY_KEY</code>: value outputted when adding the deploy key earlier
(<strong>secret</strong>)</li>
<li><code>AWS_ACCESS_KEY_ID</code>: access key ID of the IAM user allowed to invalidate
CloudFront (public)</li>
<li><code>AWS_SECRET_ACCESS_KEY</code>: access key of the IAM user allowed to invalidate
CloudFront (<strong>secret</strong>)</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../infra/guidelines/index.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../infra/docs/index.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../infra/guidelines/index.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../infra/docs/index.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../elasticlunr.min.js"></script>
        <script src="../../mark.min.js"></script>
        <script src="../../searcher.js"></script>

        <script src="../../clipboard.min.js"></script>
        <script src="../../highlight.js"></script>
        <script src="../../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../../js/moment.min.js"></script>
        <script src="../../js/index.js"></script>


    </div>
    </body>
</html>
